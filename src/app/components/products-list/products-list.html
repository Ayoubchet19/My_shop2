@let results = products.results;

<mat-card class="p-4 shadow-md rounded-2xl border">
  <div class="flex justify-between items-center p-3">
    <h2 class="text-lg font-semibold">Product List</h2>

    <mat-form-field appearance="fill" class="min-w-[200px]">
      <mat-label>Order by</mat-label>
      <mat-select [value]="ordering" (selectionChange)="orderingChange.emit($event.value)">
        <mat-option value="">Default</mat-option>
        <mat-option value="+name">Name (A–Z)</mat-option>
        <mat-option value="-name">Name (Z–A)</mat-option>
        <mat-option value="+price">Price (Low → High)</mat-option>
        <mat-option value="-price">Price (High → Low)</mat-option>
        <mat-option value="+_avg">Rating (Low → High)</mat-option>
        <mat-option value="-_avg">Rating (High → Low)</mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <table
    mat-table
    [dataSource]="results"
    class="mat-elevation-z2 w-full rounded-xl overflow-hidden"
  >
    <!-- ID -->
    <ng-container matColumnDef="id">
      <th mat-header-cell *matHeaderCellDef>#</th>
      <td mat-cell *matCellDef="let p">{{ p.id }}</td>
    </ng-container>

    <!-- Name -->
    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef>Name</th>
      <td mat-cell *matCellDef="let p">{{ p.name }}</td>
    </ng-container>

    <!-- Price -->
    <ng-container matColumnDef="price">
      <th mat-header-cell *matHeaderCellDef>Price</th>
      <td mat-cell *matCellDef="let p">{{ p.price | currency: 'USD' }}</td>
    </ng-container>

    <!-- Avg Rating -->
    <ng-container matColumnDef="_avg">
      <th mat-header-cell *matHeaderCellDef>Avg Rating</th>
      <td mat-cell *matCellDef="let p">{{ p._avg ?? '—' }}</td>
    </ng-container>

    <!-- Created -->
    <ng-container matColumnDef="created_at">
      <th mat-header-cell *matHeaderCellDef>Created</th>
      <td mat-cell *matCellDef="let p">{{ p.created_at | date: 'mediumDate' }}</td>
    </ng-container>

    <!-- Action -->
    <ng-container matColumnDef="action">
      <th mat-header-cell *matHeaderCellDef>Action</th>
      <td mat-cell *matCellDef="let p" class="space-x-2">
        <a mat-stroked-button color="primary" [routerLink]="'/products/' + p.id">Details</a>
        <a mat-button color="accent" [routerLink]="'/products/' + p.id + '/rating'">Rating</a>
      </td>
    </ng-container>

    <tr
      mat-header-row
      *matHeaderRowDef="['id', 'name', 'price', '_avg', 'created_at', 'action']"
    ></tr>
    <tr
      mat-row
      *matRowDef="let row; columns: ['id', 'name', 'price', '_avg', 'created_at', 'action']"
    ></tr>

    <tr class="mat-row" *matNoDataRow>
      <td class="mat-cell text-center py-4" colspan="6">No products found</td>
    </tr>
  </table>

  <mat-paginator
    [length]="products.count || 0"
    [pageSize]="10"
    [pageSizeOptions]="[5, 10, 25, 50]"
    (page)="pageChange.emit($event)"
    class="mt-4"
  ></mat-paginator>
</mat-card>
